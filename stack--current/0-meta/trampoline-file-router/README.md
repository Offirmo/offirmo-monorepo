# TrampolineFileRouter

**Route files to different editors based on their path — not just their extension.**

macOS only lets you set one default app per file type. If you work across multiple projects and prefer different editors for each (e.g., WebStorm for work, Cursor for personal, DataGrip for SQL), you're stuck manually choosing "Open With" every time.

TrampolineFileRouter is a tiny invisible macOS app that sits between you and your editors. It registers as the default handler for code file types, checks configurable rules (by path, extension, or both), and instantly bounces the file to the right editor. You never see it — it opens, routes, and quits in under a second.

## Setup

### Prerequisites

- macOS 13+
- Xcode Command Line Tools (`xcode-select --install`)
- [duti](https://github.com/moretension/duti) — for setting default file handlers
  ```bash
  brew install duti
  # or
  sudo port install duti
  ```

### Install

```bash
# 1. Build the app and install to ~/Applications/
bash ~/.local/share/trampoline-file-router/build-app-and-install.sh

# 2. Edit the config to set your routing rules
$EDITOR ~/.config/trampoline-file-router/config.jsonc

# 3. Set TrampolineFileRouter as the default handler
#    (this snapshots your current defaults into a restore script first)
bash ~/.local/share/trampoline-file-router/register-extensions.sh
```

### Verify

```bash
# Check what handles .ts files now
duti -x ts
# Should show: TrampolineFileRouter

# Test it
open /path/to/some/file.ts
# Should open in the editor matching your rules
```

### Configuration

Edit `~/.config/trampoline-file-router/config.jsonc` (changes take effect immediately, no rebuild needed):

```jsonc
{
  "defaultApp": "Cursor",
  "rules": [
    // All files under this folder open in WebStorm
    { "pathPrefix": "~/work/my-project", "app": "WebStorm" },

    // All .py files open in PyCharm
    { "extensions": ["py", "pyw"], "app": "PyCharm" },

    // Only .rs files under this folder open in RustRover
    { "pathPrefix": "~/projects/rust", "extensions": ["rs", "toml"], "app": "RustRover" }
  ]
}
```

- First matching rule wins — put specific rules before general ones.
- `pathPrefix` supports `~` and `$HOME`.
- `pathPrefix` and `extensions` are both optional; when both are present, both must match (AND).

### Logs

```bash
tail -f ~/.config/trampoline-file-router/trampoline-file-router.log
```

## Uninstall

```bash
# 1. Restore your previous file type defaults
#    Use the restore script generated by register-extensions.sh:
bash ~/.config/trampoline-file-router/restore-previous-*.sh
#    Or use the initial snapshot:
bash ~/.local/share/trampoline-file-router/restore-safe-state.sh

# 2. Remove the app
rm -rf ~/Applications/TrampolineFileRouter.app

# 3. Remove config and logs (optional)
rm -rf ~/.config/trampoline-file-router

# 4. Remove source (optional)
rm -rf ~/.local/share/trampoline-file-router
```

## Rebuild after source changes

```bash
bash ~/.local/share/trampoline-file-router/build-app-and-install.sh
```

Config changes do NOT require a rebuild. Only rebuild after editing `main.swift` or `Info.plist`.
